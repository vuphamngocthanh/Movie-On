<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org" lang="en" dir="ltr">
<head th:replace="~{admin/common/head :: head}"></head>
<body class="app aside-menu-fixed sidebar-lg-show">
<div th:replace="~{admin/common/header :: header}"></div>
<div class="app-body">
    <div th:include="~{admin/common/sidebar :: sidebar}"></div>
    <main class="main pt-3">
        <nav aria-label="breadcrumb" class="d-none d-lg-block">
            <ol class="breadcrumb bg-transparent p-0 justify-content-end">
                <li class="breadcrumb-item text-capitalize"><a href="https://phimmoichilli.com/admin/dashboard">Admin</a></li>
                <li class="breadcrumb-item text-capitalize"><a href="https://phimmoichilli.com/admin/movie">movies</a></li>
                <li class="breadcrumb-item text-capitalize active" aria-current="page">Add</li>
            </ol>
        </nav>
        <section class="container-fluid">
            <h2>
                <span class="text-capitalize">movies</span>
                <small>Add movie.</small>
                <small><a href="https://phimmoichilli.com/admin/movie" class="d-print-none font-sm"><i class="la la-angle-double-left"></i>
                    Back to all
                    <span>movies</span></a></small>
            </h2>
        </section>
        <div class="container-fluid animated fadeIn">
            <div class="row">
                <div class="col-md-8 bold-labels">
                    <form th:action="@{/admin-movie/list-movie/save}" th:object="${movie}" method="post">
                        <div class="tab-container mb-2">
                            <div class="nav-tabs-custom">
                                <ul class="nav nav-tabs " role="tablist">
                                    <li role="presentation" class="nav-item">
                                        <a href="#tab_thong-tin-phim" aria-controls="tab_thong-tin-phim" role="tab" tab_name="thong-tin-phim" data-toggle="tab" class="nav-link" >Thông tin phim</a>
                                    </li>
                                    <li role="presentation" class="nav-item">
                                        <a href="#tab_phan-loai" aria-controls="tab_phan-loai" role="tab" tab_name="phan-loai" data-toggle="tab" class="nav-link">Phân loại</a>
                                    </li>
                                    <li role="presentation" class="nav-item">
                                        <a href="#tab_danh-sach-tap-phim" aria-controls="tab_danh-sach-tap-phim" role="tab" tab_name="danh-sach-tap-phim" data-toggle="tab" class="nav-link" >Danh sách tập phim</a>
                                    </li>
                                </ul>
                                <div class="tab-content p-0">
                                    <div class="tab-pane active" id="tab_thong-tin-phim">
                                        <div class="row">
                                            <div class="form-group col-md-6 required">
                                                <label>Tên phim</label>
                                                <input type="text" th:field="*{name}" placeholder="Tên" class="form-control" />
                                            </div>
                                            <div class="form-group col-md-6 required">
                                                <label>Tên gốc</label>
                                                <input type="text" th:field="*{originName}" class="form-control" />
                                            </div>
                                            <div class="form-group col-sm-12">
                                                <label>Đường dẫn tĩnh</label>
                                                <input type="text" th:field="*{movie_slug}" class="form-control" />
                                            </div>
<!--                                            <div class="form-group col-sm-12">-->
<!--                                                <input type="hidden" th:field="*{cr}" class="form-control" />-->
<!--                                            </div>-->
                                            <div class="form-group col-sm-12" >
                                                <label>Ảnh Thumb</label>
                                                <div class="input-group">
                                                    <input type="text" th:field="*{thumbUrl}" class="form-control" lang="es">
                                                </div>
                                            </div>
                                            <div class="form-group col-sm-12" >
                                                <label>Nội dung</label>
                                                <textarea id="summernote" name="editordata" th:field="*{content}"></textarea>
                                            </div>
                                            <div class="form-group col-sm-12">
                                                <label>Thông báo / ghi chú</label>
                                                <input type="text" th:field="*{notes}" placeholder="Tuần này hoãn chiếu" class="form-control">
                                            </div>
                                            <div class="form-group col-sm-12" >
                                                <label>Lịch chiếu phim</label>
                                                <input type="text" th:field="*{movieSchedule}" placeholder="21h tối hàng ngày" class="form-control">
                                            </div>
                                            <div class="form-group col-sm-12" >
                                                <label>Trailer Youtube URL</label>
                                                <input type="text" th:field="*{movieTrailer}" class="form-control">
                                            </div>
                                            <div class="form-group col-md-4" >
                                                <label>Thời lượng tập phim</label>
                                                <input type="text" th:field="*{episodeDuration}" placeholder="45 phút" class="form-control">
                                            </div>
                                            <div class="form-group col-md-4" >
                                                <label>Tập phim hiện tại</label>
                                                <input type="text" th:field="*{currentEpisode}" placeholder="5" class="form-control">
                                            </div>
                                            <div class="form-group col-md-4" >
                                                <label>Tổng số tập phim</label>
                                                <input type="text" th:field="*{totalEpisode}" placeholder="12" class="form-control">
                                            </div>
                                            <div class="form-group col-md-4" >
                                                <label>Ngôn ngữ</label>
                                                <input type="text" th:field="*{movieLang}" placeholder="Tiếng Việt" class="form-control">
                                            </div>
                                            <div class="form-group col-md-4" >
                                                <label>Chất lượng</label>
                                                <input type="text" th:field="*{quality}" class="form-control">
                                            </div>
                                            <div class="form-group col-md-4" >
                                                <label>Năm xuất bản</label>
                                                <input type="text" th:field="*{publishYear}" class="form-control">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane" id="tab_phan-loai" data-select2-id="tab_phan-loai">
                                        <div class="row">
                                            <div class="form-group col-sm-12">
                                                <label>Phân Loại</label>
                                                <div class="row" >
                                                    <div class="col-sm-4">
                                                        <div class="checkbox" >
                                                            <label class="font-weight-normal">
                                                                <input type="checkbox" th:value="1" th:field="*{movie_nominate}"/>Đề cử phim hay
                                                            </label>
                                                        </div>
                                                        <div class="checkbox" >
                                                            <label class="font-weight-normal">
                                                                <input type="checkbox" th:value="1" th:field="*{movieCinema}"/>Phim chiếu rạp
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="form-group col-sm-12">
                                                <label>Thể Loại</label>
                                                <div class="row" >
                                                    <div class="col-sm-4" th:each="c : ${regions}">
                                                        <div class="checkbox" >
                                                            <label class="font-weight-normal">
                                                                <input type="checkbox"
                                                                       th:field="*{region}"
                                                                       th:value="${c.id}"
                                                                       th:text="${c.name}"/>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="form-group col-sm-12">
                                                <label>Quốc gia</label>
                                                <div class="row" >
                                                    <div class="col-sm-4" th:each="c : ${categories}">
                                                        <div class="checkbox" >
                                                            <label class="font-weight-normal">
                                                                <input type="checkbox"
                                                                       th:field="*{categories}"
                                                                       th:value="${c.id}"
                                                                       th:text="${c.name}"/>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        </div>
                                    <div role="tabpanel" class="tab-pane active" id="tab_danh-sach-tap-phim">
                                        <div class="row">

                                            <div class="form-group col-sm-12" element="div" bp-field-wrapper="true" bp-field-name="episodes" bp-field-type="view">
                                                <div class="mb-4">
                                                    <div class="p-0">
                                                        <div class="input-group mb-3 col-md-6 px-0">
                                                            <input id="new-server-name" type="text" value="Thuyết minh #1" placeholder="Tên server" class="form-control">
                                                                <span class="input-group-append">
                                                                <button type="button" id="add-server-btn" class="btn btn-success">
                                                                Thêm
                                                                <i class="la la-plus"></i>
                                                                </button></span>
                                                        </div>
                                                        <ul class="nav nav-tabs" role="tablist" id="episode-server-list">
                                                            <li class="nav-item"><a class="nav-link episode-server active" data-toggle="tab" href="#episode-server-0" role="tab" aria-controls="home" aria-selected="true" contenteditable="" onblur="if (!window.__cfRLUnblockHandlers) return false; updateEpisodeServer(this)">Vietsub
                                                                #1</a>
                                                            </li>
                                                        </ul>
                                                        <div class="tab-content" id="episode-server-data">
                                                            <div class="tab-pane active" id="episode-server-0" role="tabpanel">
                                                                <div class="form-inline justify-content-left mb-3 px-0">
                                                                    <button type="button" class="btn btn-warning add-episode-btn" data-server="0" data-server-name="Vietsub #1">
                                                                        Thêm tập mới
                                                                    </button>
                                                                    <button type="button" class="btn btn-danger ml-2 float-right delete-server">
                                                                        Xóa server
                                                                    </button>
                                                                </div>
                                                                <div class="table-responsive" style="max-height: 400px; overflow:auto;">
                                                                    <table class="table table-bordered mb-4">
                                                                        <thead>
                                                                        <tr>
                                                                            <th>Tên</th>
                                                                            <th>Slug</th>
                                                                            <th>Type</th>
                                                                            <th>Link</th>
                                                                            <th></th>
                                                                        </tr>
                                                                        </thead>
                                                                        <tbody>
                                                                        <th:block>
                                                                        <tr class="episode" >
                                                                            <td><input type="text" placeholder="Tập 1" th:field="*{episodes[0].nameEpisode}" class="form-control">
                                                                            </td>
                                                                            <td><input type="text" placeholder="tap-1" th:field="*{episodes[0].slug}" class="form-control"></td>
                                                                            <td>
                                                                                <select th:field="*{episodes[0].server}" class="form-control">
                                                                                    <option value="embed">Nhúng</option>
                                                                                    <option value="mp4">MP4</option>
                                                                                    <option value="m3u8">M3U8</option>
                                                                                </select>
                                                                            </td>
                                                                            <td><input type="text" placeholder="" th:field="*{episodes[0].link}" class="form-control" ></td>
                                                                            <td class="text-center"><span style="cursor:pointer" class="badge outline-badge-danger delete-episode">Xóa</span></td>
                                                                        </tr>
                                                                        </th:block>
                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer" type="text/javascript"></script>
                                                <script type="text/javascript">
                                                    $("#add-server-btn").click(function(e) {
                                                        const serverCount = $('#episode-server-list').children('.nav-item').length;
                                                        const serverName = $('#new-server-name').val();

                                                        const templateList = (i, name) => {
                                                            return `<li class="nav-item"><a class="nav-link episode-server" data-toggle="tab" href="#episode-server-${i}"
                            role="tab" aria-controls="episode-server-${i}" aria-selected="true" contenteditable>${name}</a>
                    </li>`;
                                                        }
                                                        const templateData = (i, name) => {
                                                            return `<div class="tab-pane" id="episode-server-${i}" role="tabpanel">
                        <div class="table-responsive mb-3" style="max-height: 400px; overflow:auto;">
                            <table class="table table-bordered mb-4">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Slug</th>
                                        <th>Type</th>
                                        <th>Link</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>

                                </tbody>
                            </table>
                        </div>
                        <div class="form-inline justify-content-left mb-3 px-0">
                            <button type="button" class="btn btn-warning mr-2 add-episode-btn" data-server="${i}" data-server-name="${name}">
                                Thêm tập mới
                            </button>
                            <button type="button" class="btn btn-danger float-right delete-server">
                                Xóa server
                            </button>
                        </div>
                    </div>`;
                                                        }

                                                        $('#episode-server-list').append(templateList(serverCount, serverName));
                                                        $('#episode-server-data').append(templateData(serverCount, serverName));

                                                        $('.episode-server[data-toggle="tab"]').last().click();
                                                    });

                                                    $(document).on('click', '.delete-server', function(e) {
                                                        const tab = $(this).closest('.tab-pane');
                                                        const tabLink = $(`.nav-link[href="#${$(tab).attr('id')}"]`);
                                                        $(tab).remove();
                                                        $(tabLink).closest('.nav-item').remove();
                                                        updateNameAttr();
                                                        $('.episode-server[data-toggle="tab"]').last().click();
                                                    });

                                                    $(document).on('click', '.add-episode-btn', function(e) {
                                                        const templateEpisode = (i, server) => {
                                                            return `<tr class="episode">
                        <input type="hidden" class="episode-server" value="${server}" data-attr-id="id" data-attr-name="server">
                        <td><input type="text" placeholder="Tập 1" value="1"
                                class="ep_name form-control" data-attr-id="name" data-attr-name="name">
                        </td>
                        <td><input type="text" placeholder="tap-1" value="tap-1"
                                class="form-control" data-attr-id="slug" data-attr-name="slug"></td>
                        <td>
                            <select data-attr-name="type" class="form-control">
                                                                    <option value="embed">Nhúng</option>
                                                                    <option value="mp4">MP4</option>
                                                                    <option value="m3u8">M3U8</option>
                                                            </select>
                        </td>
                        <td><input type="text" placeholder="" value=""
                                class="form-control" data-attr-id="link" data-attr-name="link"></td>
                        <td class="text-center"><span style="cursor:pointer"
                                class="badge outline-badge-danger delete-episode">Xóa</span></td>
                    </tr>`
                                                        }
                                                        $(`#episode-server-${$(this).data('server')} table tbody`).append(templateEpisode($('.episode')
                                                            .length, $(this).data('server-name')));
                                                        updateNameAttr();
                                                    })


                                                    $(document).on('click', '.delete-episode', function(e) {
                                                        $(this).closest('tr').remove();
                                                        updateNameAttr();
                                                    })

                                                    function updateEpisodeServer(el) {
                                                        $($(el).attr('href')).find('.episode-server').val($(el).html().trim());
                                                        $($(el).attr('href')).find('.add-episode-btn').data('server-name', $(el).html().trim());
                                                    }

                                                    function updateNameAttr() {
                                                        $('.episode').each((index, episode) => {
                                                            $(episode).find('[data-attr-name]').each((i, attr) => {
                                                                const attrName = $(attr).attr('data-attr-name').split('.').reduce((a, b) =>
                                                                    `${a}${b}`, '')
                                                                $(attr).attr('name', `episodes[${index}].${attrName}`)
                                                            })
                                                        })
                                                        $('.episode').each((index, episode) => {
                                                            $(episode).find('[data-attr-id]').each((i, attr) => {
                                                                const attrId = $(attr).attr('data-attr-id').split('.').reduce((a, b) =>
                                                                    `${a}${b}`, '')
                                                                $(attr).attr('id', `episodes${index}.${attrId}`)
                                                            })
                                                        })
                                                    }
                                                </script>
                                            </div>
                                        </div>
                                    </div>
                                    </div>
                                </div>
                            </div>
                        <input type="hidden" name="_current_tab" value="thong-tin-phim" />
                        <div id="saveActions" class="form-group">
                            <input type="hidden" name="_save_action" value="save_and_back" />
                            <div class="btn-group" role="group">
                                <button type="submit" class="btn btn-success">
                                    <span class="la la-save" role="presentation" aria-hidden="true"></span>
                                    <span data-value="save_and_back">Save and back</span>
                                </button>
                            </div>
                            <a href="https://phimmoichilli.com/admin/movie" class="btn btn-default"><span class="la la-ban"></span>
                                &nbsp;Cancel</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>
</div>
<div th:replace="~{admin/common/footer :: footer}"></div>
<script type="text/javascript" src="https://phimmoichilli.com/packages/backpack/base/js/bundle.js?v=1.0.0@dae217b370cabdec958dab215801096cdacf37fe"></script>
<script type="text/javascript" src="https://phimmoichilli.com/packages/select2/dist/js/select2.full.min.js?v=1.0.0@dae217b370cabdec958dab215801096cdacf37fe"></script>
<script th:src="@{/asset/js/sumonote.js}">

</script>
<!--<script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>-->
<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.js"></script>
</body>
</html>